---
title: "Figure.4 SDATA-24-03470"
subtitle: "overall MDS plots"
---

```{r include=FALSE}

library(edgeR)
library(ggplot2)
library(ggrepel)
library(cowplot)
#
level.order.treat<-c("siNT","siNRP1.3","siNRP1.5","shNT","shNRP1.3","shNRP1.5") #custom order
#group.colors.treat<-c("darkorange","#E41A1C","purple","black","#0000FF","green")
group.colors.treat<-colorspace::desaturate(c("darkorange","#E41A1C","purple","black","#0000FF","green"),amount=0.15) #muted colors
scales::show_col(group.colors.treat)
#
level.order.line<-c("SUM159","MDAMB231","HS578T") #custom order
group.colors.line<-c("#008000","#0000FF", "#E41A1C")

```

# Genes 
```{r Genes, include=FALSE}

load("NRP1.v48-Ensembl.114-genes_2025-08-08.Rdata")
y<-yH
#
meta.data$Treat<-factor(meta.data$Treat, levels=level.order.treat)
sample.colors.treat<-group.colors.treat[as.numeric(meta.data$Treat)]
#
meta.data$Line<-factor(meta.data$Line, levels=level.order.line)
sample.colors.line<-group.colors.line[as.numeric(meta.data$Line)]
#
#
mds12<-plotMDS(y[!not.detected,], dim.plot = c(1,2), plot=F)
#plotMDS(mds12)
mds34<-plotMDS(y[!not.detected,], dim.plot = c(3,4), plot=F)
#plotMDS(mds34)
mds.g<-data.frame(Dim.1=mds12$x, Dim.2=mds12$y, Dim.3=mds34$x, Dim.4=mds34$y)
#
dim1.label<-paste0("Dim.1 (", round(mds12$var.explained[1]*100,1),"%)")
dim2.label<-paste0("Dim.2 (", round(mds12$var.explained[2]*100,1),"%)")
dim3.label<-paste0("Dim.3 (", round(mds34$var.explained[3]*100,1),"%)")
dim4.label<-paste0("Dim.4 (", round(mds34$var.explained[4]*100,1),"%)")  

```


```{r outdated.first.version, eval=FALSE, include=FALSE}

#dev.new(width=5, height=5, noRStudioGD=T)
#        
a<-ggplot(mds.g,aes(x=Dim.1, y=Dim.2, color=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_colour_manual(values=group.colors.line)+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank(), legend.position=c(0.86,0.9), legend.background=element_rect(fill='grey98'),
        legend.text=element_text(size=10))+
  theme(legend.margin = margin(t=-7, r=1, b=1, l=1, unit = "pt"))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  labs(title='Cell Line')
#
b<-ggplot(mds.g,aes(x=Dim.1, y=Dim.2, color=meta.data$Treat))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_colour_manual(values=group.colors.treat)+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank(), legend.position=c(0.87,0.82), legend.background=element_rect(fill='grey98'),
        legend.text=element_text(size=10))+
  theme(legend.margin = margin(t=-7, r=1, b=1, l=1, unit = "pt"))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  labs(title='Treatment Group')
#
c<-ggplot(mds.g,aes(x=Dim.3, y=Dim.4, color=meta.data$Treat))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_colour_manual(values=group.colors.treat)+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank(), legend.position=c(0.12,0.18), legend.background=element_rect(fill='grey98'),
        legend.text=element_text(size=10))+
  theme(legend.margin = margin(t=-7, r=1, b=1, l=1, unit = "pt"))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  labs(title='')

```


```{r current.version, include=FALSE}

#dev.new(width=5, height=5, noRStudioGD=T)
a<-ggplot(mds.g,aes(x=Dim.1, y=Dim.2, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.position='none')+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='MDS Gene Level', x=dim1.label, y=dim2.label)
#
b<-ggplot(mds.g,aes(x=Dim.3, y=Dim.4, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank())+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  guides(shape = guide_legend(override.aes = list(size = 3)))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='', x=dim3.label, y=dim4.label)

```

# Transcripts 
```{r Transcripts, include=FALSE}

load("NRP1.v48-Ensembl.114-transcripts_2025-08-08.Rdata")
y<-yH
#
meta.data$Treat<-factor(meta.data$Treat, levels=level.order.treat)
sample.colors.treat<-group.colors.treat[as.numeric(meta.data$Treat)]
#
meta.data$Line<-factor(meta.data$Line, levels=level.order.line)
sample.colors.line<-group.colors.line[as.numeric(meta.data$Line)]
#
#
mds12<-plotMDS(y[!not.detected,], dim.plot = c(1,2), plot=F)
#plotMDS(mds12)
mds34<-plotMDS(y[!not.detected,], dim.plot = c(3,4), plot=F)
#plotMDS(mds34)
mds.t<-data.frame(Dim.1=mds12$x, Dim.2=mds12$y, Dim.3=mds34$x, Dim.4=mds34$y)
#
#
dim1.label<-paste0("Dim.1 (", round(mds12$var.explained[1]*100,1),"%)")
dim2.label<-paste0("Dim.2 (", round(mds12$var.explained[2]*100,1),"%)")
dim3.label<-paste0("Dim.3 (", round(mds34$var.explained[3]*100,1),"%)")
dim4.label<-paste0("Dim.4 (", round(mds34$var.explained[4]*100,1),"%)")

```


```{r outdated.first.version, eval=FALSE, include=FALSE}

#dev.new(width=5, height=5, noRStudioGD=T)
#
d<-ggplot(mds.t,aes(x=Dim.1, y=Dim.2, color=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_colour_manual(values=group.colors.line)+
  theme_classic()+
  theme(panel.border = element_rect(color="black", fill = NA))+
  theme(legend.title=element_blank(), legend.position=c(0.86,0.9), legend.background=element_rect(fill='grey98'),
        legend.text=element_text(size=10))+
  theme(legend.margin = margin(t=-7, r=1, b=1, l=1, unit = "pt"))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  labs(title='Cell Line')
#
e<-ggplot(mds.t,aes(x=Dim.1, y=Dim.2, color=meta.data$Treat))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_colour_manual(values=group.colors.treat)+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank(), legend.position=c(0.87,0.82), legend.background=element_rect(fill='grey98'),
        legend.text=element_text(size=10))+
  theme(legend.margin = margin(t=-7, r=1, b=1, l=1, unit = "pt"))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  labs(title='Treatment Group')
#
f<-ggplot(mds.t,aes(x=Dim.3, y=Dim.4, color=meta.data$Treat))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_colour_manual(values=group.colors.treat)+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank(), legend.position=c(0.12,0.18), legend.background=element_rect(fill='grey98'),
        legend.text=element_text(size=10))+
  theme(legend.margin = margin(t=-7, r=1, b=1, l=1, unit = "pt"))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  labs(title='')

```


```{r current.version, include=FALSE}

#dev.new(width=5, height=5, noRStudioGD=T)
c<-ggplot(mds.t,aes(x=Dim.1, y=Dim.2, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.position='none')+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='MDS Transcript Level', x=dim1.label, y=dim2.label)
#
d<-ggplot(mds.t,aes(x=Dim.3, y=Dim.4, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank())+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  guides(shape = guide_legend(override.aes = list(size = 3)))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='', x=dim3.label, y=dim4.label)


```

```{r eval=FALSE, include=FALSE}

### sandpit
ggplot(mds.t,aes(x=Dim.3, y=Dim.4))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(aes(fill=meta.data$Treat, shape=meta.data$Line), size=8, alpha=0.8)+
  scale_fill_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(21,22,24))+ #with border
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank())+
  guides(fill = guide_legend(override.aes = list(size = 3, color=group.colors.treat)))+
  guides(shape = guide_legend(override.aes = list(size = 3)))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='', x=dim3.label, y=dim4.label)
#
#
### sandpit
ggplot(mds.t,aes(x=Dim.3, y=Dim.4, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=3, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank())+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  guides(shape = guide_legend(override.aes = list(size = 3)))+
  geom_text_repel(aes(label=meta.data$Repeat, color=meta.data$Treat), size=3, show.legend = FALSE)+
  labs(title='', x=dim3.label, y=dim4.label)

```

# Combined
```{r}

### outdated.first.version
# dev.new(width=15, height=10, noRStudioGD = T, rescale='fixed')
# mds.plot<-plot_grid(a,b,c,NULL,d,e,f,NULL, ncol=4, rel_widths=c(1,1,1,0.1), 
#                     align="h",axis="tb", labels=c('a)','b)','','','c)','d)'))
# mds.plot<-ggdraw(mds.plot)+
#           draw_label("Gene Level", x=0.98, y=0.8, size=15, angle=-90, fontface="bold")+
#           draw_label("Transcript Level", x=0.98, y=0.25, size=15, angle=-90, fontface="bold")
# mds.plot
#ggsave("Figure4.png") #dioesn't keep ggdraw objects
#cowplot::save_plot("Figure4.png", plot = mds.plot, dpi = 300, base_width = 15, base_height = 10) #omits ggdraw
# 
#
### A4 page in inches: 8.3 x 11.7 inches --> width=15,height=21.14
dev.new(width=10, height=10, noRStudioGD = T, rescale='fixed')
#
plot<-plot_grid(a,b,c,d, ncol=2, rel_widths=c(1,1.35), 
                     align="h",axis="tb", labels=c('a','','b',''))
plot
#
cowplot::save_plot("Figure4.pdf", plot = plot, base_width = 10, base_height = 10)

```


<br>

***  

# R.session Info


```{r Rsession, echo=FALSE}

sessionInfo() #record the R and package versions used
##############################
# R version 4.2.3 (2023-03-15 ucrt)
# Platform: x86_64-w64-mingw32/x64 (64-bit)
# Running under: Windows 10 x64 (build 19044)
# 
# Matrix products: default
# 
# locale:
# [1] LC_COLLATE=English_Australia.utf8  LC_CTYPE=English_Australia.utf8   
# [3] LC_MONETARY=English_Australia.utf8 LC_NUMERIC=C                      
# [5] LC_TIME=English_Australia.utf8    
# 
# attached base packages:
# [1] stats     graphics  grDevices utils     datasets  methods   base     
# 
# other attached packages:
# [1] cowplot_1.1.1  ggrepel_0.9.3  ggplot2_3.4.2  reshape2_1.4.4 edgeR_3.40.2   limma_3.54.2  
# 
# loaded via a namespace (and not attached):
#  [1] Rcpp_1.0.10                 locfit_1.5-9.7              lattice_0.20-45            
#  [4] Rsamtools_2.14.0            Biostrings_2.66.0           digest_0.6.31              
#  [7] R6_2.5.1                    GenomeInfoDb_1.34.9         plyr_1.8.8                 
# [10] stats4_4.2.3                Polychrome_1.5.1            evaluate_0.21              
# [13] pillar_1.11.0               zlibbioc_1.44.0             rlang_1.1.3                
# [16] rstudioapi_0.14             S4Vectors_0.36.2            Matrix_1.6-5               
# [19] rmarkdown_2.22              BiocParallel_1.32.5         stringr_1.5.0              
# [22] RCurl_1.98-1.12             DelayedArray_0.23.2         compiler_4.2.3             
# [25] rtracklayer_1.58.0          xfun_0.39                   pkgconfig_2.0.3            
# [28] BiocGenerics_0.44.0         htmltools_0.5.4             tidyselect_1.2.0           
# [31] SummarizedExperiment_1.28.0 tibble_3.2.1                GenomeInfoDbData_1.2.9     
# [34] IRanges_2.32.0              codetools_0.2-19            matrixStats_1.0.0          
# [37] XML_3.99-0.13               crayon_1.5.2                dplyr_1.1.2                
# [40] withr_2.5.0                 GenomicAlignments_1.34.1    bitops_1.0-7               
# [43] grid_4.2.3                  gtable_0.3.3                lifecycle_1.0.3            
# [46] magrittr_2.0.3              scales_1.4.0                cli_3.6.0                  
# [49] stringi_1.7.12              farver_2.1.1                XVector_0.38.0             
# [52] scatterplot3d_0.3-43        generics_0.1.3              vctrs_0.6.0                
# [55] rjson_0.2.21                restfulr_0.0.15             RColorBrewer_1.1-3         
# [58] tools_4.2.3                 Biobase_2.58.0              glue_1.6.2                 
# [61] MatrixGenerics_1.10.0       parallel_4.2.3              fastmap_1.1.1              
# [64] yaml_2.3.7                  colorspace_2.1-0            GenomicRanges_1.50.2       
# [67] knitr_1.43                  BiocIO_1.8.0               
##############################

```


***
