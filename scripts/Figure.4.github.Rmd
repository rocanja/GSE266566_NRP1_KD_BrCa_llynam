---
title: "Figure.4 SDATA-24-03470"
subtitle: "GSE266566.overall.MDS.plots"
---

```{r include=FALSE}

library(edgeR)
library(ggplot2)
library(ggrepel)
library(cowplot)
#
level.order.treat<-c("siNT","siNRP1.3","siNRP1.5","shNT","shNRP1.3","shNRP1.5") #custom order
group.colors.treat<-colorspace::desaturate(c("darkorange","#E41A1C","purple","black","#0000FF","green"),amount=0.15) #muted colors
scales::show_col(group.colors.treat)
#
level.order.line<-c("SUM159","MDAMB231","HS578T") #custom order
group.colors.line<-c("#008000","#0000FF", "#E41A1C")

```

# Genes 
```{r Genes, include=FALSE}

load("NRP1.v48-Ensembl.114-genes_2025-08-08.Rdata")
#
meta.data$Treat<-factor(meta.data$Treat, levels=level.order.treat)
sample.colors.treat<-group.colors.treat[as.numeric(meta.data$Treat)]
#
meta.data$Line<-factor(meta.data$Line, levels=level.order.line)
sample.colors.line<-group.colors.line[as.numeric(meta.data$Line)]
#
#
mds12<-plotMDS(y[!not.detected,], dim.plot = c(1,2), plot=F)
#plotMDS(mds12)
mds34<-plotMDS(y[!not.detected,], dim.plot = c(3,4), plot=F)
#plotMDS(mds34)
mds.g<-data.frame(Dim.1=mds12$x, Dim.2=mds12$y, Dim.3=mds34$x, Dim.4=mds34$y)
#
dim1.label<-paste0("Dim.1 (", round(mds12$var.explained[1]*100,1),"%)")
dim2.label<-paste0("Dim.2 (", round(mds12$var.explained[2]*100,1),"%)")
dim3.label<-paste0("Dim.3 (", round(mds34$var.explained[3]*100,1),"%)")
dim4.label<-paste0("Dim.4 (", round(mds34$var.explained[4]*100,1),"%)")  

```


```{r include=FALSE}

#dev.new(width=5, height=5, noRStudioGD=T)
a<-ggplot(mds.g,aes(x=Dim.1, y=Dim.2, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.position='none')+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='MDS Gene Level', x=dim1.label, y=dim2.label)
#
b<-ggplot(mds.g,aes(x=Dim.3, y=Dim.4, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank())+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  guides(shape = guide_legend(override.aes = list(size = 3)))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='', x=dim3.label, y=dim4.label)

```

# Transcripts 
```{r Transcripts, include=FALSE}

load("NRP1.v48-Ensembl.114-transcripts_2025-08-08.Rdata")
#
meta.data$Treat<-factor(meta.data$Treat, levels=level.order.treat)
sample.colors.treat<-group.colors.treat[as.numeric(meta.data$Treat)]
#
meta.data$Line<-factor(meta.data$Line, levels=level.order.line)
sample.colors.line<-group.colors.line[as.numeric(meta.data$Line)]
#
#
mds12<-plotMDS(y[!not.detected,], dim.plot = c(1,2), plot=F)
#plotMDS(mds12)
mds34<-plotMDS(y[!not.detected,], dim.plot = c(3,4), plot=F)
#plotMDS(mds34)
mds.t<-data.frame(Dim.1=mds12$x, Dim.2=mds12$y, Dim.3=mds34$x, Dim.4=mds34$y)
#
#
dim1.label<-paste0("Dim.1 (", round(mds12$var.explained[1]*100,1),"%)")
dim2.label<-paste0("Dim.2 (", round(mds12$var.explained[2]*100,1),"%)")
dim3.label<-paste0("Dim.3 (", round(mds34$var.explained[3]*100,1),"%)")
dim4.label<-paste0("Dim.4 (", round(mds34$var.explained[4]*100,1),"%)")

```


```{r current.version, include=FALSE}

#dev.new(width=5, height=5, noRStudioGD=T)
c<-ggplot(mds.t,aes(x=Dim.1, y=Dim.2, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.position='none')+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='MDS Transcript Level', x=dim1.label, y=dim2.label)
#
d<-ggplot(mds.t,aes(x=Dim.3, y=Dim.4, color=meta.data$Treat, shape=meta.data$Line))+ 
  geom_vline(xintercept=0, linetype='dashed')+
  geom_hline(yintercept=0, linetype='dashed')+
  geom_point(size=6, alpha=1)+
  scale_color_manual(values=group.colors.treat)+
  scale_shape_manual(values=c(19,15,17))+
  theme_classic()+
  theme(panel.border = element_rect(color = "black", fill = NA))+
  theme(legend.title=element_blank())+
  guides(color = guide_legend(override.aes = list(size = 3)))+
  guides(shape = guide_legend(override.aes = list(size = 3)))+
  geom_text(aes(label=meta.data$Repeat),size=3, color='white')+
  labs(title='', x=dim3.label, y=dim4.label)


```


# Combined
```{r}

### A4 page in inches: 8.3 x 11.7 inches --> width=15,height=21.14
dev.new(width=10, height=10, noRStudioGD = T, rescale='fixed')
#
plot<-plot_grid(a,b,c,d, ncol=2, rel_widths=c(1,1.35), 
                     align="h",axis="tb", labels=c('a','','b',''))
plot
#
cowplot::save_plot("Figure4.pdf", plot = plot, base_width = 10, base_height = 10)

```


<br>

***  

# R.session Info


```{r Rsession, echo=FALSE}

sessionInfo() #record the R and package versions used
#############################
# RStudio 2024.12.1+563 "Kousa Dogwood" Release (27771613951643d8987af2b2fb0c752081a3a853, 2025-02-02) for windows
# Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) RStudio/2024.12.1+563 Chrome/126.0.6478.234 Electron/31.7.7 Safari/537.36, Quarto 1.5.57
##############################
# R version 4.4.3 (2025-02-28 ucrt)
# Platform: x86_64-w64-mingw32/x64
# Running under: Windows 11 x64 (build 22631)
# 
# Matrix products: default
# 
# 
# locale:
# [1] LC_COLLATE=English_Australia.utf8  LC_CTYPE=English_Australia.utf8   
# [3] LC_MONETARY=English_Australia.utf8 LC_NUMERIC=C                      
# [5] LC_TIME=English_Australia.utf8    
# 
# time zone: Australia/Brisbane
# tzcode source: internal
# 
# attached base packages:
# [1] stats     graphics  grDevices utils     datasets  methods   base     
# 
# other attached packages:
# [1] edgeR_4.4.2    limma_3.62.2   cowplot_1.2.0  ggrepel_0.9.6  reshape2_1.4.4 dplyr_1.1.4   
# [7] ggplot2_4.0.0 
# 
# loaded via a namespace (and not attached):
#  [1] gtable_0.3.6       compiler_4.4.3     tidyselect_1.2.1   Rcpp_1.1.0         stringr_1.5.2     
#  [6] scales_1.4.0       yaml_2.3.10        fastmap_1.2.0      statmod_1.5.0      lattice_0.22-7    
# [11] R6_2.6.1           plyr_1.8.9         generics_0.1.4     knitr_1.50         tibble_3.3.0      
# [16] pillar_1.11.0      RColorBrewer_1.1-3 rlang_1.1.6        stringi_1.8.7      xfun_0.53         
# [21] S7_0.2.0           cli_3.6.5          withr_3.0.2        magrittr_2.0.4     locfit_1.5-9.12   
# [26] digest_0.6.37      grid_4.4.3         rstudioapi_0.17.1  lifecycle_1.0.4    vctrs_0.6.5       
# [31] evaluate_1.0.5     glue_1.8.0         farver_2.1.2       rsconnect_1.5.1    colorspace_2.1-1  
# [36] rmarkdown_2.29     tools_4.4.3        pkgconfig_2.0.3    htmltools_0.5.8.1 
##############################

```

***